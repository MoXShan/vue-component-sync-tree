"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var _components,ELTree=_interopDefault(require("element-ui/lib/tree")),ELIcon=_interopDefault(require("element-ui/lib/icon")),ELInput=_interopDefault(require("element-ui/lib/input")),ELButton=_interopDefault(require("element-ui/lib/button")),ELButtonGroup=_interopDefault(require("element-ui/lib/button-group")),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},defineProperty=function(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e},toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)},deepClone=function e(t){var i="",n=t.constructor===Array?[]:{};if("object"===(void 0===t?"undefined":_typeof(t))){if(window.JSON)i=JSON.stringify(t),n=JSON.parse(i);else for(var o in t)n[o]="object"===_typeof(t[o])?e(t[o]):t[o];return n}},arrToTree=function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=[];return t.forEach(function(o){var r=deepClone(o);Number(o.pid)===Number(i)&&(r.children=e(t,o.id),n.push(r))}),n},Tool={deepClone:deepClone,arrToTree:arrToTree};require("../lib/vue-component-sync-tree.css");var vueComponentSyncTree={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"v-component-sync-tree"},[i("div",{staticClass:"origin-tree tree-item"},[i("div",{staticClass:"tree-header"},[e._v("源列表")]),e._v(" "),i("div",{staticClass:"tree-body"},[i("el-tree",{ref:"originTree",attrs:{data:e.originTree,"show-checkbox":"",accordion:"","node-key":"id",props:e.defaultProps},on:{"check-change":e.getOriginKeys}})],1)]),e._v(" "),i("div",{staticClass:"tree-cut"},[i("i",{staticClass:"ivu-icon ivu-icon-ios-arrow-right"}),e._v(" "),i("el-icon",{staticClass:"el-icon-arrow-right"})],1),e._v(" "),i("div",{staticClass:"final-tree tree-item"},[i("div",{staticClass:"tree-header"},[e._v("目的列表")]),e._v(" "),i("div",{staticClass:"tree-body"},[i("div",{staticClass:"body-main"},[i("ul",e._l(e.finalTree,function(t){return i("li",{key:t.id},[i("span",{staticClass:"item-text"},[e._v(e._s(t.title))]),e._v(" "),i("span",{staticClass:"item-edit",on:{click:function(i){i.stopPropagation(),e.popEditModal(t.id,t.title)}}},[i("el-icon",{staticClass:"el-icon-edit"})],1),e._v(" "),i("span",{staticClass:"item-del",on:{click:function(i){i.stopPropagation(),e.popDelModal(t.id,t.pid)}}},[i("el-icon",{staticClass:"el-icon-delete"})],1),e._v(" "),i("ul",{staticStyle:{"margin-left":"20px"}},e._l(t.children,function(t){return i("li",{key:t.id},[i("span",{staticClass:"item-text"},[e._v(e._s(t.title))]),e._v(" "),i("span",{staticClass:"item-edit",on:{click:function(i){i.stopPropagation(),e.popEditModal(t.id,t.title)}}},[i("el-icon",{staticClass:"el-icon-edit"})],1),e._v(" "),i("span",{staticClass:"item-del",on:{click:function(i){i.stopPropagation(),e.popDelModal(t.id,t.pid)}}},[i("el-icon",{staticClass:"el-icon-delete"})],1)])}))])}))]),e._v(" "),e.editShow?i("div",{staticClass:"edit-mask"},[i("div",{staticClass:"edit-wrapper"},[i("el-input",{staticClass:"edit-input",model:{value:e.editText,callback:function(t){e.editText=t},expression:"editText"}}),e._v(" "),i("div",{staticClass:"edit-opra-wrapper"},[i("el-button-group",[i("el-button",{staticClass:"edit-cancel",attrs:{type:"default"},on:{click:e.editCancel}},[e._v("\n                                取消\n                            ")]),e._v(" "),i("el-button",{staticClass:"edit-ok",attrs:{type:"primary"},on:{click:e.editOk}},[e._v("\n                                确认\n                            ")])],1)],1)],1)]):e._e(),e._v(" "),e.delShow?i("div",{staticClass:"del-mask"},[i("div",{staticClass:"del-wrapper"},[i("div",{staticClass:"del-text"},[i("el-icon",{staticClass:"el-icon-warning"}),e._v("\n                        是否删除\n                    ")],1),e._v(" "),i("div",{staticClass:"del-opra-wrapper"},[i("el-button-group",[i("el-button",{staticClass:"del-cancel",on:{click:e.delCancel}},[e._v("\n                                取消\n                            ")]),e._v(" "),i("el-button",{staticClass:"del-ok",attrs:{type:"primary"},on:{click:e.delOk}},[e._v("\n                                确认\n                            ")])],1)],1)])]):e._e()])])])},staticRenderFns:[],name:"vueComponentSyncTree",model:{prop:"finalList",event:"change"},props:{finalList:{type:Array,default:function(){return[]}},data:{type:Array,default:function(){return[]}}},data:function(){return{delShow:!1,delId:"",delPid:"",editShow:!1,editText:"",editId:"",originTree:[],originKeys:[],defaultProps:{children:"children",label:"title"}}},components:(_components={},defineProperty(_components,ELTree.name,ELTree),defineProperty(_components,ELIcon.name,ELIcon),defineProperty(_components,ELInput.name,ELInput),defineProperty(_components,ELButton.name,ELButton),defineProperty(_components,ELButtonGroup.name,ELButtonGroup),_components),computed:{originList:function(){return this.data},finalTree:function(){return Tool.arrToTree(this.finalList)},finalKeys:function(){return this.finalList.map(function(e){return e.id})},originToFinalKeys:function(){var e=this,t=[];return this.originList.forEach(function(i){e.originKeys.includes(i.id)&&0!==Number(i.pid)&&t.push(i.pid)}),this.unique([].concat(t,toConsumableArray(this.originKeys)))}},created:function(){this.initOriginTree()},mounted:function(){this.initOriginChecked()},methods:{popDelModal:function(e,t){this.delId=e,this.delPid=t,this.delShow=!0},delOk:function(){var e=this,t=[];t.push(this.delId),0===Number(this.delPid)?this.finalTree.forEach(function(i){i.id===e.delId&&i.children.forEach(function(e){t.push(e.id)})}):t.push(this.delPid),t.forEach(function(t){e.originKeys=e.removeByValue(e.originKeys,t)}),this.$refs.originTree.setCheckedKeys(this.originKeys),this.delCancel()},delCancel:function(){this.delShow=!1,this.delId="",this.delPid=""},popEditModal:function(e,t){this.editId=e,this.editText=t,this.editShow=!0},editOk:function(){var e=this;this.finalList.forEach(function(t){t.id===e.editId&&(t.title=e.editText)}),this.editCancel()},editCancel:function(){this.editShow=!1,this.editId="",this.editText=""},initOriginTree:function(){this.originTree=Tool.arrToTree(this.originList)},initOriginChecked:function(){var e=this,t=[];this.finalList.forEach(function(i){0!==Number(i.pid)?t.push(i.id):e.finalList.map(function(e){return e.pid}).includes(i.id)||t.push(i.id)}),this.$refs.originTree.setCheckedKeys(t)},getOriginKeys:function(){this.originKeys=this.$refs.originTree.getCheckedKeys(),this.editCancel(),this.delCancel()},findOut:function(e,t){return e.filter(function(e){return!t.includes(e)})},removeByValue:function(e,t){var i=e.indexOf(t);return-1!==i&&e.splice(i,1),e},unique:function(e){var t=[];return e.forEach(function(e){t.includes(e)||t.push(e)}),t}},watch:{originToFinalKeys:function(){var e=this;this.findOut(this.originToFinalKeys,this.finalKeys).forEach(function(t){e.originList.forEach(function(i){i.id===t&&e.finalList.push(Tool.deepClone(i))})}),this.findOut(this.finalKeys,this.originToFinalKeys).forEach(function(t){e.finalList.forEach(function(i){i.id===t&&(e.finalList=e.removeByValue(e.finalList,i))})})},finalList:function(){this.initOriginChecked()}}},componentSyncTree={install:function(e,t){e.component(vueComponentSyncTree.name,vueComponentSyncTree)}};module.exports=componentSyncTree;
